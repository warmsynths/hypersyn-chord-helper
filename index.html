<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
      .sidebar-toggle-fade {
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
      }
      #sidebarToggle {
        transition: opacity 0.3s ease;
      }
    </style>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hypersyn Chord Helper</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap"
      rel="stylesheet"
    />
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ¶</text></svg>"
    />
    <link rel="stylesheet" href="src/styles.css" />
  </head>
  <body class="flex flex-col items-center p-8 space-y-6 sm:p-4 sm:space-y-4">
    <!-- Collapsible Sidebar -->
    <div
      id="sidebar"
      class="fixed top-0 left-0 h-full w-64 bg-gray-900 bg-opacity-95 shadow-lg z-30 transform -translate-x-full transition-transform duration-300 ease-in-out flex flex-col"
    >
      <div
        class="flex items-center justify-between px-4 py-3 border-b border-gray-700"
      >
        <span class="text-pink-400 font-bold text-lg">Utilities</span>
        <button
          onclick="toggleSidebar()"
          class="text-gray-400 hover:text-white focus:outline-none text-2xl"
        >
          &times;
        </button>
      </div>
      <div class="flex-1 p-4 overflow-y-auto">
        <!-- Compact Preview Section in Sidebar -->
        <div class="flex flex-col space-y-4">
          <!-- Save/Load Chord Sets Section in Sidebar -->
          <div>
            <h2 class="text-pink-400 text-lg font-bold mb-2">
              Save/Load Chord Sets
            </h2>
            <div class="flex flex-col space-y-2 mb-2">
              <div class="flex space-x-2">
                <input
                  id="chordSetNameInput"
                  type="text"
                  placeholder="Set name..."
                  class="flex-1 p-1 rounded border border-gray-300 bg-gray-800 text-yellow-200 text-xs"
                />
                <button
                  onclick="saveChordSet()"
                  class="px-2 py-1 bg-pink-600 text-white rounded text-xs"
                >
                  Save
                </button>
              </div>
              <div class="flex space-x-2">
                <select
                  id="savedChordSetsSelect"
                  class="flex-1 p-1 rounded border border-gray-300 bg-gray-800 text-blue-200 text-xs"
                >
                  <option value="">Load saved set...</option>
                </select>
              </div>
              <div class="flex space-x-2">
                <button
                  onclick="loadChordSet()"
                  class="flex-1 px-2 py-1 bg-gray-600 text-white rounded text-xs cursor-pointer text-center"
                >
                  Load
                </button>
                <button
                  onclick="deleteChordSet()"
                  class="flex-1 px-2 py-1 bg-gray-600 text-white rounded text-xs cursor-pointer text-center"
                >
                  Delete
                </button>
              </div>
              <div class="flex space-x-2">
                <button
                  onclick="window.exportChordSets()"
                  class="flex-1 px-2 py-1 bg-pink-600 text-white rounded text-xs"
                >
                  Export
                </button>
                <label
                  for="importChordSetsInput"
                  class="flex-1 px-2 py-1 bg-gray-600 text-white rounded text-xs cursor-pointer text-center"
                  style="display: inline-block"
                >
                  Import
                  <input
                    id="importChordSetsInput"
                    type="file"
                    accept="application/json"
                    style="display: none"
                    onchange="window.importChordSets(this)"
                  />
                </label>
              </div>
            </div>
          </div>
          <hr class="my-4 border-gray-700" />
          <div>
            <h2 class="text-pink-400 text-lg font-bold mb-2">Preview</h2>
            <div class="flex space-x-2 mb-2">
              <button
                id="playBtn"
                class="flex-1 px-2 py-1 bg-pink-600 text-white rounded text-xs cursor-pointer text-center"
                onclick="handlePlay()"
              >
                Play
              </button>
              <button
                id="stopBtn"
                class="flex-1 px-2 py-1 bg-gray-600 text-white rounded text-xs cursor-pointer text-center"
                onclick="handleStop()"
              >
                Stop
              </button>
            </div>
            <div class="flex items-center space-x-2">
              <label class="text-yellow-300 text-sm">Volume:</label>
              <input
                id="volumeSlider"
                type="range"
                min="0"
                max="100"
                value="5"
                class="flex-1"
                oninput="updateVolumeLabel()"
              />
              <span id="volumeLabel" class="text-yellow-300 text-xs">5%</span>
            </div>
          </div>
          <div>
            <label class="block text-xs text-gray-400 mb-1"
              >Single Chord Preview</label
            >
            <div class="flex space-x-2">
              <select
                id="singleChordSelect"
                class="flex-1 p-1 rounded border border-gray-300 bg-gray-800 text-blue-200 text-xs"
                disabled
              >
                <option value="">Select a chord...</option>
              </select>
              <button
                class="px-2 py-1 bg-pink-600 text-white rounded text-xs"
                onclick="playSingleChord()"
              >
                Play
              </button>
            </div>
          </div>
          <hr class="my-4 border-gray-700" />
          <!-- How To Section in Sidebar -->
          <div>
            <h2 class="text-pink-400 text-lg font-bold mb-2">How To</h2>
            <ul class="text-xs text-gray-200 space-y-2 mb-2">
              <li>
                <strong>Paste or type a chord progression</strong> into the
                input field above.<br />
                <span class="text-blue-300"
                  >Use plain text with a single space between each chord.</span
                ><br />
                <span class="text-pink-300">Example:</span>
                <span class="text-pink-300">Am7 Dm9 G13 Cmaj7</span>
              </li>
              <li>
                <strong>Source progressions</strong> from sites like:
                <a
                  href="https://www.onemotion.com/chord-player/"
                  target="_blank"
                  class="text-blue-300 underline"
                  >onemotion chord player</a
                >,
                <a
                  href="https://chordseqai.com/"
                  target="_blank"
                  class="text-blue-300 underline"
                  >ChordSeqAI</a
                >, generate them with
                <a
                  href="https://chatgpt.com/"
                  target="_blank"
                  class="text-blue-300 underline"
                  >ChatGPT</a
                >, or even use your ðŸ§ ! ðŸ˜±
              </li>
              <li>
                <strong
                  >Click <span class="text-pink-300">Convert</span></strong
                >
                to see each chordâ€™s hex code and interval code.<br />
                <span class="text-yellow-200"
                  >These can be used directly in the Hypersyn instrument on the
                  M8 Tracker.</span
                >
              </li>
            </ul>
            <div class="text-xs text-gray-400 mb-1">
              <span class="font-semibold text-blue-200"
                >Root-baked hex codes</span
              >
              include the chordâ€™s root â€” ready to drop straight into
              Hypersyn.<br />
              <span class="font-semibold text-yellow-200"
                >Interval-only codes</span
              >
              are just the chord shape â€” you choose the root yourself in the
              phrase view.
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Sidebar Toggle Button -->
    <button
      id="sidebarToggle"
      onclick="toggleSidebar()"
      class="fixed top-4 left-4 z-40 bg-pink-600 text-white rounded-full w-12 h-12 flex items-center justify-center shadow-lg focus:outline-none sm:top-4 sm:left-4"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-6 w-6"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 6h16M4 12h16M4 18h16"
        />
      </svg>
    </button>
    <script>
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const toggleBtn = document.getElementById("sidebarToggle");
        if (sidebar.classList.contains("-translate-x-full")) {
          sidebar.classList.remove("-translate-x-full");
          toggleBtn.classList.add("sidebar-toggle-fade");
        } else {
          sidebar.classList.add("-translate-x-full");
          toggleBtn.classList.remove("sidebar-toggle-fade");
        }
      }
    </script>
    <!-- Synthwave video background -->
    <div
      id="video-bg"
      style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: -2;
        overflow: hidden;
      "
    >
      <video
        autoplay
        loop
        muted
        playsinline
        style="
          width: 100vw;
          height: 100vh;
          object-fit: cover;
          filter: blur(8px) brightness(0.7) saturate(1.1);
        "
      >
        <source src="src/assets/synthwave.mp4" type="video/mp4" />
      </video>
      <div
        style="
          position: absolute;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          background: rgba(40, 42, 54, 0.5);
          mix-blend-mode: soft-light;
        "
      ></div>
    </div>
    <h1
      class="synthwave-header text-5xl font-extrabold text-pink-400"
      style="font-family: 'Share Tech Mono', monospace !important"
    >
      Hypersyn Chord Helper
    </h1>

    <!-- Input Box with Example Progression -->
    <div class="content-box w-full max-w-lg">
      <textarea
        id="chordsInput"
        placeholder="Paste your chord progression here..."
        class="w-full p-2 border border-gray-300 rounded text-3xl"
      >
Am7 Dm9 G13 Cmaj7 Fmaj7 Bm7b5 E7 Am9</textarea
      >
      <div class="flex flex-col sm:flex-row sm:items-center gap-2 mb-2">
        <button
          onclick="convertChordsUI()"
          class="mb-2 px-4 py-2 bg-pink-600 text-white rounded w-full sm:w-auto"
        >
          Convert
        </button>

        <button
          onclick="clearInput()"
          class="mb-2 px-4 py-2 bg-gray-600 text-white rounded w-full sm:w-auto"
        >
          Clear
        </button>
      </div>
    </div>
    <!-- Preview Box (moved directly below input) -->
    <!-- Output Box -->
    <div class="content-box w-full max-w-lg">
      <button
        onclick="toggleBox('outputBox')"
        class="mb-2 px-2 py-1 bg-gray-700 text-white rounded w-full sm:w-auto dimmed"
        data-box="outputBox"
      >
        Converted Chords â–¶
      </button>
      <span class="ml-2 text-gray-400 text-sm"
        >Shows all chords with hex and interval codes</span
      >
      <div id="outputBox" class="hidden">
        <div id="output" class="text-lg"></div>
      </div>
    </div>

    <!-- Info Box (moved to bottom) -->
    <!-- Toast Notification Container -->
    <div
      id="toastContainer"
      class="fixed top-6 left-1/2 transform -translate-x-1/2 z-50 flex flex-col items-center space-y-2"
    ></div>

    <script type="text/javascript" src="src/core.js"></script>
    <script>
      // Simple keyboard visualization for voicing
      function updateKeyboardViz() {
        // Example: show C4-B4, highlight notes in current voicing
        const keyboardDiv = document.getElementById("keyboardViz");
        if (!keyboardDiv) return;
        // For demo, use C major triad for 'closed', Dm for 'open-triad', etc.
        const voicing = document.getElementById("voicingSelect").value;
        // Map voicing to notes (MIDI numbers for C4-B4: 60-71)
        let notes = [];
        if (voicing === "closed") notes = [60, 64, 67]; // C E G
        else if (voicing === "open-triad") notes = [62, 65, 69]; // D F A
        else if (voicing === "drop2") notes = [60, 65, 67]; // C F G
        else if (voicing === "drop3") notes = [60, 64, 69]; // C E A
        else if (voicing === "spread") notes = [60, 67, 71]; // C G B
        else if (voicing === "octave") notes = [60, 72]; // C C
        else if (voicing === "first-inversion") notes = [64, 67, 72]; // E G C
        else if (voicing === "second-inversion") notes = [67, 72, 76]; // G C E
        else if (voicing === "third-inversion") notes = [71, 76, 79]; // B E G
        else if (voicing === "shell-dominant") notes = [60, 67]; // C G
        else if (voicing === "altered-dominant") notes = [60, 64, 70]; // C E Bb
        // Render keyboard SVG (C4 to C5, 13 keys)
        let svg = '<svg width="130" height="40">';
        const noteNames = [
          "C",
          "C#",
          "D",
          "D#",
          "E",
          "F",
          "F#",
          "G",
          "G#",
          "A",
          "A#",
          "B",
          "C",
        ];
        for (let i = 0; i < 13; i++) {
          const x = i * 10;
          const midi = 60 + i;
          const isActive = notes.includes(midi);
          svg += `<rect x="${x}" y="5" width="10" height="30" rx="2" fill="${
            isActive ? "#ff79c6" : "#282a36"
          }" stroke="#444" />`;
          svg += `<text x="${
            x + 5
          }" y="35" text-anchor="middle" font-size="8" fill="#fff">${
            noteNames[i]
          }</text>`;
        }
        svg += "</svg>";
        keyboardDiv.innerHTML = svg;
      }
      // Initialize on page load
      window.addEventListener("DOMContentLoaded", updateKeyboardViz);
    </script>
    <script>
      // Toast fade animations (keep in index.html for style injection)
      const style = document.createElement("style");
      style.innerHTML = `
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        .animate-fadeIn { animation: fadeIn 0.3s ease; }
        .animate-fadeOut { animation: fadeOut 0.6s ease forwards; }
      `;
      document.head.appendChild(style);
      // Update dropdown on page load
      window.addEventListener(
        "DOMContentLoaded",
        window.updateSavedChordSetsDropdown
      );
      // Track play state
      let isPlaying = false;

      function setPlayVisualState(playing) {
        const playBtn = document.getElementById("playBtn");
        const stopBtn = document.getElementById("stopBtn");
        if (playing) {
          playBtn.classList.add(
            "ring-4",
            "ring-green-300",
            "scale-95",
            "shadow-lg"
          );
          stopBtn.classList.add(
            "ring-2",
            "ring-red-400",
            "scale-105",
            "shadow-md"
          );
        } else {
          playBtn.classList.remove(
            "ring-4",
            "ring-green-300",
            "scale-95",
            "shadow-lg"
          );
          stopBtn.classList.remove(
            "ring-2",
            "ring-red-400",
            "scale-105",
            "shadow-md"
          );
        }
      }

      function handlePlay() {
        if (!isPlaying) {
          isPlaying = true;
          setPlayVisualState(true);
          window.playChordProgression();
          // Estimate total duration and reset state after
          const input = document.getElementById("chordsInput").value;
          const chordCount = input
            .split(/\s|,/)
            .filter((s) => s.length > 0).length;
          const chordDuration = 2.5;
          setTimeout(() => {
            isPlaying = false;
            setPlayVisualState(false);
          }, chordCount * chordDuration * 1000 + 100);
        }
      }

      function handleStop() {
        if (isPlaying) {
          isPlaying = false;
          setPlayVisualState(false);
          window.stopChordProgression();
        } else {
          window.stopChordProgression();
        }
      }
      // Only keep updateVolumeLabel and UI logic
      function updateVolumeLabel() {
        const slider = document.getElementById("volumeSlider");
        document.getElementById("volumeLabel").textContent = slider.value + "%";
      }

      function toggleBox(boxId) {
        const el = document.getElementById(boxId);
        if (!el) return;
        const isOpen = el.style.display === "none" ? false : true;
        el.style.display = isOpen ? "none" : "block";
        // Find the button that toggles this box
        const btns = document.querySelectorAll(
          `button[onclick*="toggleBox('${boxId}'"]`
        );
        btns.forEach((btn) => {
          if (isOpen) {
            btn.innerHTML = btn.innerHTML.replace("â–¼", "â–¶");
          } else {
            btn.innerHTML = btn.innerHTML.replace("â–¶", "â–¼");
          }
        });
      }

      function updateSingleChordDropdown(chordNames) {
        const select = document.getElementById("singleChordSelect");
        if (!select) return;
        select.innerHTML = '<option value="">Select a chord...</option>';
        chordNames.forEach((chord) => {
          select.innerHTML += `<option value="${chord}">${chord}</option>`;
        });
        select.disabled = false;
        select.classList.remove("dimmed");
      }

      // Standalone function to update single chord dropdown
      function updateSingleChordDropdownFromInput() {
        const input = document.getElementById("chordsInput").value;
        const chordNames = input.split(/\s|,/).filter((s) => s.length > 0);
        updateSingleChordDropdown(chordNames);
      }

      function convertChordsUI() {
        // Show converted chord boxes
        document.getElementById("outputBox").style.display = "block";
        // Get dropdown buttons once
        const outputBtn = document.querySelector(
          'button[data-box="outputBox"]'
        );
        if (outputBtn)
          outputBtn.innerHTML = outputBtn.innerHTML.replace("â–¶", "â–¼");

        // Use the logic from core.js for conversion and display
        const input = document.getElementById("chordsInput").value;
        const chordNames = input.split(/[\s,]+/).filter((s) => s.length > 0);
        updateSingleChordDropdown(chordNames);
        const voicing = window.getSelectedVoicing
          ? window.getSelectedVoicing()
          : "closed";
        const result = window.convertChords(input, voicing);
        // Build output HTML: 4 columns, show note and chord as A(m7), add unique chord number
        let outputHTML = "";
        if (result.chords && result.chords.length > 0) {
          // Map chord name to unique chord number
          const chordNumMap = {};
          result.uniqueGroups.forEach((group, idx) => {
            group.chords.forEach((chordName) => {
              chordNumMap[chordName] = idx.toString().padStart(2, "0");
            });
          });
          // Build rows of 4 columns
          outputHTML +=
            '<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">';
          result.chords.forEach((chord, i) => {
            // Set midiRoot for each chord using core.js utility
            chord.midiRoot = window.getMidiRoot
              ? window.getMidiRoot(chord.root)
              : 60;
            const intervalHexSpans = chord.intervalOnlyHex
              .map(
                (hex, idx) =>
                  `<span${idx >= 6 ? ' class="dimmed"' : ""}>${hex}</span>`
              )
              .join(" ");
            const rootBakedSpans = chord.rootBaked
              .map(
                (hex, idx) =>
                  `<span${idx >= 6 ? ' class="dimmed"' : ""}>${hex}</span>`
              )
              .join(" ");
            // Show note and chord as A(m7), add unique chord number
            const chordNum = chordNumMap[chord.chordName] || "--";
            // Get valid voicings for this chord from core.js utility
            const voicingOptions = window.getValidVoicings
              ? window.getValidVoicings(chord.intervalOnly)
              : [];
            const voicingSelect = `<select class="chord-voicing-select mb-2 p-1 rounded border border-gray-300 bg-gray-800 text-blue-200 text-xs" data-chord-idx="${i}" onchange="updateChordVoicing(${i}, this.value)">
              ${voicingOptions
                .map(
                  (opt) =>
                    `<option value=\"${opt.value}\">${opt.label}</option>`
                )
                .join("")}
            </select>`;
            // Per-chord voicing dropdown and keyboard viz
            outputHTML += `<div class="p-3 rounded bg-gray-800 text-white shadow">
              <span class="chord-name text-lg font-bold">${chord.root}(${chord.type}) <span class="text-yellow-300 text-sm">${chordNum}</span></span><br>
              <span class="root-baked-label">Root-baked:</span> <span class="root-baked-value">${rootBakedSpans}</span><br>
              <span class="interval-label">Interval:</span> <span class="interval-value">${intervalHexSpans}</span>
              <div class="mt-2 flex flex-col items-center">
                ${voicingSelect}
                <div id="chordKeyboardViz${i}"></div>
              </div>
            </div>`;
            // Store per-chord voicing selections
            window.chordVoicings = {};

            // Update keyboard visualization for a specific chord
            window.updateChordKeyboardViz = function (idx, voicing, chordObj) {
              const keyboardDiv = document.getElementById(
                "chordKeyboardViz" + idx
              );
              if (!keyboardDiv || !chordObj) return;
              // Get notes for this chord and voicing
              let notes = [];
              if (
                chordObj.intervalOnly &&
                Array.isArray(chordObj.intervalOnly)
              ) {
                // Use intervals directly, do not re-apply voicing
                const midiRoot = chordObj.midiRoot || 60; // fallback to C4
                notes = chordObj.intervalOnly.map((v) => midiRoot + v);
              }
              // Render two octaves (C4â€“C5 and C5â€“C6), each as a row
              const octaves = [60, 72]; // C4, C5
              const noteNames = [
                "C",
                "C#",
                "D",
                "D#",
                "E",
                "F",
                "F#",
                "G",
                "G#",
                "A",
                "A#",
                "B",
                "C",
              ];
              let svg = '<svg width="130" height="90">';
              octaves.forEach((oct, row) => {
                for (let i = 0; i < 13; i++) {
                  const x = i * 10;
                  const y = 5 + row * 40;
                  const midi = oct + i;
                  const isActive = notes.includes(midi);
                  svg += `<rect x="${x}" y="${y}" width="10" height="30" rx="2" fill="${
                    isActive ? "#ff79c6" : "#282a36"
                  }" stroke="#444" />`;
                  svg += `<text x="${x + 5}" y="${
                    y + 30
                  }" text-anchor="middle" font-size="8" fill="#fff">${
                    noteNames[i]
                  }</text>`;
                }
              });
              svg += "</svg>";
              keyboardDiv.innerHTML = svg;
            };

            // Called when user changes voicing for a chord
            window.updateChordVoicing = function (idx, voicing) {
              window.chordVoicings[idx] = voicing;
              if (window.lastChordObjs && window.lastChordObjs[idx]) {
                const chordObj = window.lastChordObjs[idx];
                if (Array.isArray(chordObj.intervalOnly)) {
                  // Get voiced intervals
                  let voicedIntervals = chordObj.intervalOnly;
                  if (typeof window.applyVoicing === "function") {
                    voicedIntervals = window.applyVoicing(
                      chordObj.intervalOnly,
                      voicing
                    );
                  }
                  // Convert intervals to hex codes
                  const midiRoot = chordObj.midiRoot || 60;
                  const rootBakedHex = voicedIntervals
                    .map((v) => {
                      const hex = (midiRoot + v).toString(16).toUpperCase();
                      return `<span>${hex}</span>`;
                    })
                    .join(" ");
                  // Use core.js intervalOnlyHex for correct formatting
                  const chordObjUpdated = Object.assign({}, chordObj, {
                    intervalOnly: voicedIntervals,
                    intervalOnlyHex: voicedIntervals.map(window.semitoneToHex),
                  });
                  const intervalHex = chordObjUpdated.intervalOnlyHex
                    .map((hex) => `<span>${hex}</span>`)
                    .join(" ");
                  // Update DOM
                  const chordBox = document
                    .getElementById("chordKeyboardViz" + idx)
                    .closest(".p-3");
                  if (chordBox) {
                    const rootBakedEl =
                      chordBox.querySelector(".root-baked-value");
                    const intervalEl =
                      chordBox.querySelector(".interval-value");
                    if (rootBakedEl) rootBakedEl.innerHTML = rootBakedHex;
                    if (intervalEl) intervalEl.innerHTML = intervalHex;
                  }
                  // Update keyboard visualization with new intervals and hex
                  window.updateChordKeyboardViz(idx, voicing, chordObjUpdated);
                }
              }
            };

            // After rendering output grid, initialize all chord voicings and visualizations
            window.lastChordObjs = result.chords;
            window.chordVoicings = {};
            setTimeout(() => {
              result.chords.forEach((chord, i) => {
                window.chordVoicings[i] = "closed";
                window.updateChordKeyboardViz(i, "closed", chord);
              });
            }, 0);
          });
          outputHTML += "</div>";
        } else {
          outputHTML = "No valid chords found.<br><br>";
          window.showToast("No valid chords found.", "error");
        }
        document.getElementById("output").innerHTML = outputHTML;

        // Dim output dropdown button if no chords
        if (!outputHTML || !outputHTML.trim()) {
          outputBtn.classList.add("dimmed");
        } else {
          outputBtn.classList.remove("dimmed");
        }
      }

      function playSingleChord() {
        const select = document.getElementById("singleChordSelect");
        const chordName = select.value;
        if (!chordName || chordName === "Select a chord...") return;
        const chordObj = window.parseChordName(chordName);
        if (chordObj && typeof window.playSingleChordGlobal === "function") {
          window.playSingleChordGlobal(chordObj);
        } else {
          showToast("Chord playback not available.", "error");
        }
      }

      function clearInput() {
        document.getElementById("chordsInput").value = "";
        updateSingleChordDropdown([]);
        document.getElementById("output").innerHTML = "";
        document.getElementById("uniqueChordTypes").innerHTML = "";
      }

      // Returns the selected voicing type from the dropdown
      window.getSelectedVoicing = function () {
        const select = document.getElementById("voicingSelect");
        return select ? select.value : "closed";
      };
    </script>
  </body>
  <!-- Video credit as page content -->
  <div
    id="video-credit"
    style="
      margin: 2.5rem auto 0 auto;
      font-size: 0.95rem;
      color: #8be9fd;
      background: rgba(40, 42, 54, 0.7);
      padding: 6px 14px;
      border-radius: 8px;
      font-family: 'Share Tech Mono', monospace;
      box-shadow: 0 2px 8px #000;
      text-align: center;
      display: inline-flex;
      align-items: center;
    "
  >
    <span style="display: inline">
      Video by
      <a
        href="https://www.reddit.com/user/visualdon/"
        target="_blank"
        style="color: #ff79c6; text-decoration: underline"
        >visualdon</a
      >
      on Reddit
    </span>
    <button
      id="toggleVideoBtn"
      onclick="window.toggleVideoBg()"
      style="
        background: #282a36;
        color: #f8f8f2;
        border: none;
        border-radius: 5px;
        padding: 2px 10px;
        font-size: 0.95em;
        cursor: pointer;
        margin-left: 0.7em;
        display: inline;
      "
    >
      Hide Video
    </button>
  </div>
  <style>
    .dimmed {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</html>
