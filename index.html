<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Hypersyn Chord Helper</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #282a36; /* Dracula background */
        color: #f8f8f2; /* Dracula foreground */
        font-family: monospace;
        font-size: 1.25rem;
      }
      .content-box {
        .synthwave-header {
          font-family: "Share Tech Mono", monospace;
          letter-spacing: 2px;
          text-shadow: 0 2px 8px #ff79c6, 0 0px 32px #8be9fd;
        }
        background-color: #1e1f29;
        border: 1px solid #44475a;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1rem;
        width: 80%; /* consistent width */
        max-width: 800px;
      }
      textarea {
        width: 100%;
        height: 120px;
        background-color: #1e1f29;
        color: #bd93f9; /* Dracula purple for input text */
        border: none;
        resize: vertical;
        font-size: 1.25rem;
      }
      .chord-name {
        color: #ff79c6; /* pink */
        font-weight: bold;
      }
      .root-baked-label {
        color: #50fa7b; /* green */
        font-weight: bold;
      }
      .root-baked-value {
        color: #f1fa8c; /* yellow */
      }
      .interval-label {
        color: #8be9fd; /* cyan */
        font-weight: bold;
      }
      .interval-value {
        color: #ffb86c; /* Dracula orange */
      }
    </style>
  </head>
  <body class="flex flex-col items-center p-8 space-y-6">
    <!-- Synthwave video background -->
    <div
      id="video-bg"
      style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: -2;
        overflow: hidden;
      "
    >
      <video
        autoplay
        loop
        muted
        playsinline
        style="
          width: 100vw;
          height: 100vh;
          object-fit: cover;
          filter: blur(8px) brightness(0.7) saturate(1.1);
        "
      >
        <source src="src/assets/synthwave.mp4" type="video/mp4" />
      </video>
      <div
        style="
          position: absolute;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          background: rgba(40, 42, 54, 0.5);
          mix-blend-mode: soft-light;
        "
      ></div>
    </div>
    <h1
      class="synthwave-header text-5xl font-extrabold text-pink-400"
      style="font-family: 'Share Tech Mono', monospace !important"
    >
      Hypersyn Chord Helper
    </h1>

    <!-- Input Box with Example Progression -->
    <div class="content-box">
      <textarea
        id="chordsInput"
        placeholder="Paste your chord progression here..."
      >
Am7 Dm9 G13 Cmaj7 Fmaj7 Bø7 E7alt Am9</textarea
      >
      <button
        onclick="convertChords()"
        class="mt-2 px-4 py-2 bg-pink-600 text-white rounded"
      >
        Convert
      </button>
      <button
        id="playBtn"
        onclick="handlePlay()"
        class="mt-2 ml-2 px-4 py-2 bg-green-600 text-white rounded transition-all border border-green-700"
      >
        Play
      </button>
      <button
        id="stopBtn"
        onclick="handleStop()"
        class="mt-2 ml-2 px-4 py-2 text-white rounded transition-all border"
        style="background-color: #ff5555; border-color: #ff79c6"
      >
        Stop
      </button>
      <label class="ml-4 text-yellow-300">Volume:</label>
      <input
        id="volumeSlider"
        type="range"
        min="0"
        max="100"
        value="5"
        style="vertical-align: middle; width: 120px"
        oninput="updateVolumeLabel()"
      />
      <span id="volumeLabel" class="ml-2 text-yellow-300">5%</span>
    </div>

    <!-- Info Box -->
    <div class="content-box">
      <button
        onclick="toggleBox('infoBox')"
        class="mb-2 px-2 py-1 bg-gray-700 text-white rounded"
      >
        Info ▼
      </button>
      <span class="ml-2 text-gray-400 text-sm"
        >How to use this tool</span
      >
      <div id="infoBox" style="display: none">
        <div style="margin-bottom:1rem;">
          <span class="interval-label">How to use this tool:</span>
          <ul style="margin-top:0.5rem; margin-bottom:0.5rem;">
            <li>Paste or type a chord progression into the input field above. Use plain text with a single space between each chord (e.g., <span style="color:#ff79c6">Am7 Dm9 G13 Cmaj7</span>).</li>
            <li>You can source progressions from sites like <a href="https://www.onemotion.com/chord-player/" target="_blank" style="color:#8be9fd; text-decoration:underline;">onemotion chord player</a>, <a href="https://chordseqai.com/" target="_blank" style="color:#8be9fd; text-decoration:underline;">ChordSeqAI</a>, or even generate them with <a href="https://chatgpt.com/" target="_blank" style="color:#8be9fd; text-decoration:underline;">ChatGPT</a>.</li>
            <li>Click <span style="color:#ff79c6">Convert</span> to see each chord’s hex code and interval code. These can be used directly in the <span style="color:#f1fa8c">Hypersyn</span> instrument on the <span style="color:#50fa7b">M8 Tracker</span>.</li>
            <li>Click <span style="color:#50fa7b">Play</span> to audition the progression as a synth pad, or <span style="color:#ff5555">Stop</span> to halt playback.</li>
            <li>Explore the <span style="color:#8be9fd">Unique Chord Types</span> box to see interval structures grouped by type.</li>
          </ul>
        </div>
        <p>
          <span class="root-baked-label">Root-baked hex codes</span> include the
          chord’s root — ready to drop straight into Hypersyn.
        </p>
        <p>
          <span class="interval-label">Interval-only codes</span> are just the
          chord shape — you choose the root yourself in the phrase view.
        </p>
      </div>
    </div>

    <!-- Unique Chord Types Box -->
    <div class="content-box">
      <button
        onclick="toggleBox('uniqueBox')"
        class="mb-2 px-2 py-1 bg-gray-700 text-white rounded"
      >
        Unique Chord Types ▼
      </button>
      <span class="ml-2 text-gray-400 text-sm"
        >Groups by chord type and shows intervals</span
      >
      <div id="uniqueBox" style="display: none">
        <div id="uniqueChordTypes" style="font-size: 1.25rem"></div>
      </div>
    </div>

    <!-- Output Box -->
    <div class="content-box">
      <button
        onclick="toggleBox('outputBox')"
        class="mb-2 px-2 py-1 bg-gray-700 text-white rounded"
      >
        Converted Chords ▼
      </button>
      <span class="ml-2 text-gray-400 text-sm"
        >Shows all chords with hex and interval codes</span
      >
      <div id="outputBox" style="display: none">
        <div id="output" style="font-size: 1.25rem"></div>
      </div>
    </div>

    <script type="text/javascript" src="src/core.js"></script>
    <script>
      // Track play state
      let isPlaying = false;

      function setPlayVisualState(playing) {
        const playBtn = document.getElementById("playBtn");
        const stopBtn = document.getElementById("stopBtn");
        if (playing) {
          playBtn.classList.add(
            "ring-4",
            "ring-green-300",
            "scale-95",
            "shadow-lg"
          );
          stopBtn.classList.add(
            "ring-2",
            "ring-red-400",
            "scale-105",
            "shadow-md"
          );
        } else {
          playBtn.classList.remove(
            "ring-4",
            "ring-green-300",
            "scale-95",
            "shadow-lg"
          );
          stopBtn.classList.remove(
            "ring-2",
            "ring-red-400",
            "scale-105",
            "shadow-md"
          );
        }
      }

      function handlePlay() {
        if (!isPlaying) {
          isPlaying = true;
          setPlayVisualState(true);
          window.playChordProgression();
          // Estimate total duration and reset state after
          const input = document.getElementById("chordsInput").value;
          const chordCount = input
            .split(/\s|,/)
            .filter((s) => s.length > 0).length;
          const chordDuration = 2.5;
          setTimeout(() => {
            isPlaying = false;
            setPlayVisualState(false);
          }, chordCount * chordDuration * 1000 + 100);
        }
      }

      function handleStop() {
        if (isPlaying) {
          isPlaying = false;
          setPlayVisualState(false);
          window.stopChordProgression();
        } else {
          window.stopChordProgression();
        }
      }
      // Only keep updateVolumeLabel and UI logic
      function updateVolumeLabel() {
        const slider = document.getElementById("volumeSlider");
        document.getElementById("volumeLabel").textContent = slider.value + "%";
      }

      function toggleBox(boxId) {
        const el = document.getElementById(boxId);
        if (!el) return;
        el.style.display = el.style.display === "none" ? "block" : "none";
      }

      function convertChords() {
        // Show unique and converted chord boxes
        document.getElementById("uniqueBox").style.display = "block";
        document.getElementById("outputBox").style.display = "block";
        if (typeof window.convertChords !== "function") {
          document.getElementById("output").innerHTML =
            '<span style="color:red">Chord logic not loaded.</span>';
          return;
        }

        // Use the logic from core.js
        const input = document.getElementById("chordsInput").value;
        const chordNames = input.split(/[\s,]+/).filter((s) => s.length > 0);
        const parsed = chordNames
          .map(window.parseChordName)
          .filter((c) => c !== null);

        // Display all input chords as entered
        let outputHTML = "";
        parsed.forEach((chord) => {
          outputHTML += `
          <div class="mb-4">
            <span class="chord-name">${chord.chordName} (${
            chord.type
          })</span><br>
            <span class="root-baked-label">Root-baked:</span> 
            <span class="root-baked-value">${chord.rootBaked.join(
              " "
            )}</span><br>
            <span class="interval-label">Interval:</span> 
            <span class="interval-value">${chord.intervalOnlyHex.join(
              " "
            )}</span>
          </div>
        `;
        });
        document.getElementById("output").innerHTML = outputHTML;

        // Find all unique chord types and group them
        const uniqueTypes = {};
        parsed.forEach((chord) => {
          if (!uniqueTypes[chord.type]) uniqueTypes[chord.type] = [];
          uniqueTypes[chord.type].push(chord.chordName);
        });

        let uniqueHTML =
          '<span class="interval-label">Unique Chord Types:</span><ul style="margin-top:0.5rem;">';
        Object.keys(uniqueTypes).forEach((type, idx) => {
          // Get interval array for this type from core.js
          const intervals = window.chordTypes
            ? window.chordTypes[type]
            : window.chordTypes === undefined &&
              window.core &&
              window.core.chordTypes
            ? window.core.chordTypes[type]
            : typeof chordTypes !== "undefined"
            ? chordTypes[type]
            : undefined;
          let intervalStr = "";
          if (intervals) {
            intervalStr = intervals
              .map((i) => {
                let hex = (i % 12).toString(16).toUpperCase();
                return hex.length === 1 ? "0" + hex : hex;
              })
              .join(" ");
          }
          uniqueHTML += `<li>
          <span class="chord-name">Chord ${idx
            .toString()
            .padStart(2, "0")}</span><br>
          <span class="root-baked-label">Chords:</span> <span class="root-baked-value">${[
            ...new Set(uniqueTypes[type]),
          ].join(", ")}</span><br>
          <span class="interval-label">Interval:</span> <span class="interval-value">${intervalStr}</span>
        </li>`;
        });
        uniqueHTML += "</ul>";
        document.getElementById("uniqueChordTypes").innerHTML = uniqueHTML;
      }

      function toggleVideoBg() {
        const videoBg = document.getElementById("video-bg");
        const btn = document.getElementById("toggleVideoBtn");
        if (videoBg.style.display === "none") {
          videoBg.style.display = "";
          btn.textContent = "Hide Video";
        } else {
          videoBg.style.display = "none";
          btn.textContent = "Show Video";
        }
      }

      // Collapse unique and converted chord boxes on page load
      window.onload = function () {
        document.getElementById("uniqueBox").style.display = "none";
        document.getElementById("outputBox").style.display = "none";
      };
    </script>
  </body>
  <!-- Video credit as page content -->
  <div id="video-credit" style="margin: 2.5rem auto 0 auto; font-size: 0.95rem; color: #8be9fd; background: rgba(40,42,54,0.7); padding: 6px 14px; border-radius: 8px; font-family: 'Share Tech Mono', monospace; box-shadow: 0 2px 8px #000; text-align: center; display: inline-flex; align-items: center;">
    <span style="display:inline;">
      Video by <a href="https://www.reddit.com/user/visualdon/" target="_blank" style="color: #ff79c6; text-decoration: underline">visualdon</a> on Reddit
    </span>
    <button id="toggleVideoBtn" onclick="toggleVideoBg()" style="background: #282a36; color: #f8f8f2; border: none; border-radius: 5px; padding: 2px 10px; font-size: 0.95em; cursor: pointer; margin-left: 0.7em; display:inline;">Hide Video</button>
  </div>
</html>
